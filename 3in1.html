<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>EMT ìŒ€ë¨¹ í‚¤íŠ¸</title>
    <style>
        body { font-family: sans-serif; line-height: 1.5; padding: 20px; background-color: #f4f4f4; }
        .section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
        textarea { width: 100%; margin-top: 10px; border: 1px solid #ccc; border-radius: 4px; padding: 8px; }
        button { cursor: pointer; padding: 5px 10px; margin: 2px; border-radius: 4px; border: 1px solid #34495e; background: #34495e; color: white; }
        button:hover { background: #2c3e50; }
        .res-box { background: #eee; padding: 10px; margin-top: 10px; min-height: 20px; border-radius: 4px; }
        input[size="2"] { text-align: center; }
    </style>
</head>
<body>

<div class="section">
    <h2>ë¹„ìƒëŒ€ê¸°ì Parser</h2>
    <textarea id="parseI" cols="60" rows="4" placeholder="ì›ë³¸ ë³µë¶™ (íƒ­ìœ¼ë¡œ êµ¬ë¶„ëœ 1ì‹œê°„/30ë¶„ ì¸ì›)"></textarea><br>
    <button onclick="parseRun()">ë³€í™˜ ë° í¸ì„± ğŸš€</button><br><br>
    1. ì‰¼í‘œ (ì…€ 1ê°œ í†µí•©): <button onclick="qCopy('parseO1')">í‘œ ë³µì‚¬</button>
    <div id="parseO1" class="res-box"></div>
    2. ì •ë ¬ (ì´ë¦„/ì‹œê°„ ë¶„ë¦¬): <button onclick="qCopy('parseO2')">í‘œ ë³µì‚¬</button>
    <div id="parseO2" class="res-box"></div>
</div>

<div class="section">
    <h2>ë³‘ì‚¬íœ´ê°€ Scraper</h2>
    ë³µë¶™ê¸°ì¤€ <input type="number" id="solOF" value="5" style="width:40px">ì—´ ì „ | 
    <label><input type="checkbox" id="solSW"> ìŠ¤ìœ™â˜‘ï¸</label><br>
    ì¡°íšŒì¼: <input id="solM" size="2">ì›” <input id="solD" size="2">ì¼ 
    <button onclick="solP()">âª ì´ì „</button>
    <button onclick="solRun()">ì¡°íšŒ+ë³µì‚¬ ğŸš€</button> 
    <button onclick="solN()">ë‹¤ìŒ â©</button><br>
    <span id="solINF" style="color:#27ae60;font-weight:bold;"></span>
    <span id="solMSG" style="color:red;font-weight:bold;margin-left:5px;"></span><br>
    <textarea id="solI" cols="60" rows="4" placeholder="ë”± 'íœ´ê°€ ê·¸ë¦¬ë“œ'ë§Œ ë³µë¶™"></textarea>
    <div id="solO" class="res-box"></div>
</div>

<div class="section">
    <h2>ê°„ë¶€íœ´ê°€ Scraper</h2>
    ì¡°íšŒì¼: <input id="offM" size="2">ì›” <input id="offD" size="2">ì¼ 
    <label><input type="checkbox" id="offSW"> ìŠ¤ìœ™â˜‘ï¸</label><br>
    <button onclick="offP()">âª ì´ì „</button>
    <button onclick="offRun()">ì¡°íšŒ+ë³µì‚¬ ğŸš€</button> 
    <button onclick="offN()">ë‹¤ìŒ â©</button><br>
    <span id="offINF" style="color:#27ae60;font-weight:bold;"></span>
    <span id="offMSG" style="color:red;font-weight:bold;margin-left:5px;"></span><br>
    <textarea id="offI" cols="60" rows="8" placeholder="ë‚ ì§œ í—¤ë” í¬í•¨ íŒ€ë³„ ë°ì´í„°ë¥¼ í†µì§¸ë¡œ ë³µë¶™"></textarea>
    <div id="offO" class="res-box"></div>
</div>

<script>
/* ê³µí†µ ì„¤ì • ë° ë³µì‚¬ í•¨ìˆ˜ */
const AM=2, AD=17, Y=2026;
const VM={"í¬ìƒ":"í¬ìƒíœ´ê°€","ë³´ìƒ":"ë³´ìƒíœ´ê°€","ìœ„ë¡œ":"ìœ„ë¡œíœ´ê°€","í¬íœ´":"í¬ìƒíœ´ê°€","ì—°ê°€":"ì—°ê°€","ê³µê°€":"ê³µê°€","ì™¸ë°•":"ì™¸ë°•"};
const qCopy=id=>{
    const s=getSelection(), r=document.createRange(), e=document.getElementById(id);
    r.selectNodeContents(e.querySelector('table') || e);
    s.removeAllRanges(); s.addRange(r); document.execCommand("copy"); s.removeAllRanges();
};

/* --- 1. ë¹„ìƒëŒ€ê¸°ì Parser ë¡œì§ --- */
const W_List="ëŒ€ìœ„,ëŒ€ìœ„(ì§„),ì¤‘ìœ„,ì¤‘ìœ„(ì§„),ì†Œìœ„,ì†Œìœ„(ì§„),ì¤€ìœ„,ì›ì‚¬,ì›ì‚¬(ì§„),ìƒì‚¬,ìƒì‚¬(ì§„),ì¤‘ì‚¬,ì¤‘ì‚¬(ì§„),í•˜ì‚¬,í•˜ì‚¬(ì§„)".split(',');
const getW=s=>{let i=W_List.indexOf(s.split(' ')[0]); return i<0?99:i;};
function parseRun(){
    let v=document.getElementById('parseI').value.replace(/"/g, ""); if(!v)return;
    let L1=[], L2=[], A=[];
    v.split('\n').map(L=>{
        let P=L.split('\t'), p1=[], p2=[];
        if(P[0]){ p1=P[0].split('/').map(x=>x.trim()).filter(x=>x); if(p1.length) L1.push(p1.join(', ')); p1.map(x=>A.push({n:x,t:"1ì‹œê°„"})); }
        if(P[1]){ p2=P[1].split('/').map(x=>x.trim()).filter(x=>x); if(p2.length) L2.push(p2.join(', ')); p2.map(x=>A.push({n:x,t:"30ë¶„"})); }
    });
    document.getElementById('parseO1').innerHTML = `<table border='1'><tr><td>${L1.join('<br>')}</td>${L2.length?`<td>${L2.join('<br>')}</td>`:''}</tr></table>`;
    let g=(...indices)=>indices.map(x=>A[x]).filter(x=>x).sort((a,b)=>getW(a.n)-getW(b.n));
    let F=[...g(0,1,5),...g(2,3),...g(4,6),...g(7)];
    document.getElementById('parseO2').innerHTML = `<table border='1'>${F.map(x=>`<tr><td>${x.n}</td><td>${x.t}</td></tr>`).join('')}</table>`;
}

/* --- 2. ë³‘ì‚¬íœ´ê°€ Scraper ë¡œì§ --- */
const SOL_LIST = `
ë³‘ì¥ ì´ë¦„1
ë³‘ì¥ ì´ë¦„2
ë³‘ì¥ ì´ë¦„3
ë³‘ì¥ ì´ë¦„4
ë³‘ì¥ ì´ë¦„5
ë³‘ì¥ ì´ë¦„6
ìƒë³‘ ì´ë¦„7
ìƒë³‘ ì´ë¦„8
ìƒë³‘ ì´ë¦„9
ìƒë³‘ ì´ë¦„10
ìƒë³‘ ì´ë¦„11
ì¼ë³‘ ì´ë¦„12
ì¼ë³‘ ì´ë¦„13
ì¼ë³‘ ì´ë¦„14
ì´ë³‘ ì´ë¦„15
`.trim().split('\n');
document.getElementById('solM').value=2; document.getElementById('solD').value=20;

function getSic(m, d, sw){
    let ep=new Date(Y,AM-1,AD-1).setHours(0,0,0,0), td=Math.round((new Date(Y,m-1,d).setHours(0,0,0,0)-ep)/864e5);
    let cd=((td%5)+5)%5; return cd==0?0:cd==1?(sw?2:1):cd+1;
}
function solN(){
    let sic=getSic(+solM.value,+solD.value,solSW.checked);
    if(sic==1)solSW.checked=true; else{solSW.checked=false; let n=new Date(Y,+solM.value-1,+solD.value+1); solM.value=n.getMonth()+1; solD.value=n.getDate();}
    solOF.value=+solOF.value+1; solRun();
}
function solP(){
    let sic=getSic(+solM.value,+solD.value,solSW.checked);
    if(sic==2)solSW.checked=false; else{if(sic==3)solSW.checked=true; else solSW.checked=false; let n=new Date(Y,+solM.value-1,+solD.value-1); solM.value=n.getMonth()+1; solD.value=n.getDate();}
    solOF.value=+solOF.value-1; solRun();
}
function solRun(){
    let m=+solM.value, d=+solD.value, of=+solOF.value, v=solI.value, ans=[], W=0;
    let ep=new Date(Y,AM-1,AD-1).setHours(0,0,0,0), target=new Date(Y,m-1,d).setHours(0,0,0,0);
    let sic=getSic(m,d,solSW.checked), ca=Math.floor(Math.round((target-ep)/864e5)/5)*6+sic, sa=ca-of;
    solINF.innerText=`[${m}.${d}. ${["MOR","MID","SWI","AFT","BRK","BRK"][sic]} ê¸°ì¤€]`; solMSG.innerText=""; if(!v) return;
    let gD=a=>new Date(ep+(Math.floor(a/6)*5+[0,1,1,2,3,4][((a%6)+6)%6])*864e5), ls=v.split('\n').map(x=>x.split('\t').map(y=>y.trim()));
    SOL_LIST.forEach((sl,i)=>{
        let r=ls[i]; if(!r)return;
        for(let j=0;j<r.length;j++){
            let lv=r[j]; if(lv=="íœ´"||VM[lv]){
                if(gD(sa+j).getTime()==target){
                    let st=j, ed=j; while(st>0&&r[st-1]==lv)st--; while(ed<r.length-1&&r[ed+1]==lv)ed++; if(st==0||ed==r.length-1)W=1;
                    let d1=gD(sa+st),d2=gD(sa+ed),vn=VM[lv]||lv,dt=d1.getTime()==d2.getTime()?`(${d1.getMonth()+1}.${d1.getDate()}.)`:`(${d1.getMonth()+1}.${d1.getDate()}.~${d1.getMonth()==d2.getMonth()?"":d2.getMonth()+1+"."}${d2.getDate()}.)`;
                    ans.push(`${sl}<br><br>${lv=="íœ´"?"":`(${vn})<br><br>`}${dt}`); break;
                }
            }
        }
    });
    solO.innerHTML=`<table id='solT' border='1'><tr><td valign='top'>${ans.join("<br><br><br>")}</td></tr></table>`;
    if(W)solMSG.innerText="âš ï¸ ì§¤ë¦¼ì£¼ì˜!"; qCopy('solO');
}

/* --- 3. ê°„ë¶€íœ´ê°€ Scraper ë¡œì§ --- */
document.getElementById('offM').value=2; document.getElementById('offD').value=20;
function offN(){
    let sic=getSic(+offM.value,+offD.value,offSW.checked);
    if(sic==1)offSW.checked=true; else{offSW.checked=false; let n=new Date(Y,+offM.value-1,+offD.value+1); offM.value=n.getMonth()+1; offD.value=n.getDate();} offRun();
}
function offP(){
    let sic=getSic(+offM.value,+offD.value,offSW.checked);
    if(sic==2)offSW.checked=false; else{if(sic==3)offSW.checked=true; else offSW.checked=false; let n=new Date(Y,+offM.value-1,+offD.value-1); offM.value=n.getMonth()+1; offD.value=n.getDate();} offRun();
}
function offRun(){
    let m=+offM.value, d=+offD.value, v=offI.value, t=0, b=0;
    let R={1:{},2:{},3:{},4:{}}; for(let i=1;i<5;i++) R[i]={"ì‚¬":[],"ì¤€":[],"ë¶€":[]};
    let sic=getSic(m,d,offSW.checked); offINF.innerText=`[${m}.${d}. ${["MOR","MID","SWI","AFT","BRK","BRK"][sic]} ê¸°ì¤€]`;
    offMSG.innerText=""; if(!v)return;
    let ls=v.split('\n').map(x=>x.split('\t').map(y=>y.trim())), targetCol=-1, lastH=null;
    ls.forEach(L=>{
        if(L.some(c=>c==d.toString())){
            let idxs=L.map((c,i)=>c==d.toString()?i:-1).filter(i=>i!=-1);
            targetCol=(idxs.length>1&&offSW.checked)?idxs[1]:idxs[0]; lastH=L; if(!b){t++;b=1;} return;
        }
        if(L.length<2||(!L[0]&&!L[1])){b=0; return;}
        let r=L[0], n=L[1], k=""; if(r.includes("ì¤€ìœ„"))k="ì¤€"; else if(r.includes("ìœ„")||r.includes("ë ¹"))k="ì‚¬"; else if(r.includes("ì‚¬")||r.includes("ì›"))k="ë¶€";
        if(!k||targetCol==-1||!lastH)return;
        let lv=L[targetCol]; if(lv=="íœ´"||VM[lv]){
            let st=targetCol, ed=targetCol; while(st>2&&L[st-1]==lv)st--; while(ed<L.length-1&&L[ed+1]==lv)ed++;
            let d1=lastH[st]||d, d2=lastH[ed]||d, vn=VM[lv]||lv, dt=(d1==d2)?`(${m}.${d1}.)`:`(${m}.${d1}.~${d2}.)`;
            R[t][k].push(`${r} ${n}<br><br>${lv=="íœ´"?"":`(${vn})<br><br>`}${dt}`);
        }
    });
    let h="<table id='offT' border='1'><tr>";
    for(let i=1;i<5;i++) ["ì‚¬","ì¤€","ë¶€"].forEach(k=>h+=`<td valign='top'>${R[i][k].join("<br><br><br>")}</td>`);
    offO.innerHTML=h+"</tr></table>"; qCopy('offO');
}
</script>
</body>
</html>