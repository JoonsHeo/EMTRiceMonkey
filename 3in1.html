<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>EMT ìŒ€ë¨¹ í‚¤íŠ¸</title>
    <style>
        body { font-family: sans-serif; line-height: 1.5; padding: 20px; background-color: #f4f4f4; }
        .section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #ddd; }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px; margin-top: 0; }
        textarea { width: 100%; margin-top: 10px; border: 1px solid #ccc; border-radius: 4px; padding: 8px; box-sizing: border-box; }
        button { cursor: pointer; padding: 5px 10px; margin: 2px; border-radius: 4px; border: 1px solid #34495e; background: #34495e; color: white; }
        .res-box { background: #eee; padding: 10px; margin-top: 10px; border-radius: 4px; overflow-x: auto; }
        input[size="2"] { text-align: center; width: 35px; }
    </style>
</head>
<body>

<div class="section">
    <h2>ë¹„ìƒëŒ€ê¸°ì Parser</h2>
    <textarea id="parseI" rows="3" placeholder="íƒ­ êµ¬ë¶„ 1ì‹œê°„/30ë¶„ ì¸ì›"></textarea>
    <button onclick="parseRun()">ë³€í™˜ ğŸš€</button> | 
    <button onclick="qCopy('parseO1')">ì‰¼í‘œ ë³µì‚¬</button>
    <button onclick="qCopy('parseO2')">ì •ë ¬ ë³µì‚¬</button>
    <div id="parseO1" class="res-box"></div>
    <div id="parseO2" class="res-box"></div>
</div>

<div class="section">
    <h2>ë³‘ì‚¬íœ´ê°€ Scraper</h2>
    ê¸°ì¤€: <input type="number" id="solOF" value="5" style="width:40px">ì—´ ì „ | <label><input type="checkbox" id="solSW"> ìŠ¤ìœ™</label><br>
    ì¡°íšŒ: <input id="solM" size="2">ì›” <input id="solD" size="2">ì¼ 
    <button onclick="move(-1,'sol')">âª ì´ì „</button>
    <button onclick="solRun()">ì¡°íšŒ+ë³µì‚¬ ğŸš€</button> 
    <button onclick="move(1,'sol')">ë‹¤ìŒ â©</button>
    <span id="solINF" style="color:#27ae60;font-weight:bold;margin-left:10px;"></span>
    <span id="solMSG" style="color:red;font-weight:bold;"></span>
    <textarea id="solI" rows="3" placeholder="ë”± 'íœ´ê°€ ê·¸ë¦¬ë“œ'ë§Œ ë³µë¶™"></textarea>
    <div id="solO" class="res-box"></div>
</div>

<div class="section">
    <h2>ê°„ë¶€íœ´ê°€ Scraper</h2>
    ì¡°íšŒ: <input id="offM" size="2">ì›” <input id="offD" size="2">ì¼ <label><input type="checkbox" id="offSW"> ìŠ¤ìœ™</label>
    <button onclick="move(-1,'off')">âª ì´ì „</button>
    <button onclick="offRun()">ì¡°íšŒ+ë³µì‚¬ ğŸš€</button> 
    <button onclick="move(1,'off')">ë‹¤ìŒ â©</button>
    <span id="offINF" style="color:#27ae60;font-weight:bold;margin-left:10px;"></span>
    <textarea id="offI" rows="6" placeholder="ë‚ ì§œ í—¤ë” í¬í•¨ íŒ€ë³„ ë°ì´í„° ë³µë¶™"></textarea>
    <div id="offO" class="res-box"></div>
</div>

<script>
const $=id=>document.getElementById(id), AM=2, AD=17, Y=2026;
const VM={"í¬ìƒ":"í¬ìƒíœ´ê°€","ë³´ìƒ":"ë³´ìƒíœ´ê°€","ìœ„ë¡œ":"ìœ„ë¡œíœ´ê°€","í¬íœ´":"í¬ìƒíœ´ê°€","ì—°ê°€":"ì—°ê°€","ê³µê°€":"ê³µê°€","ì™¸ë°•":"ì™¸ë°•"};
const fmtDt=(m,d1,d2)=>d1==d2?`(${m}.${d1}.)`:`(${m}.${d1}.~${d2}.)`;

const qCopy=id=>{
    const s=getSelection(), r=document.createRange(), e=$(id);
    r.selectNodeContents(e.querySelector('table')||e);
    s.removeAllRanges(); s.addRange(r); document.execCommand("copy"); s.removeAllRanges();
};

function getSic(m, d, sw){
    let ep=new Date(Y,AM-1,AD-1).setHours(0,0,0,0), td=Math.round((new Date(Y,m-1,d).setHours(0,0,0,0)-ep)/864e5);
    let cd=((td%5)+5)%5; return cd==0?0:cd==1?(sw?2:1):cd+1;
}

function move(step, p){
    let m=$(p+'M'), d=$(p+'D'), sw=$(p+'SW'), s=getSic(+m.value,+d.value,sw.checked);
    if(step>0){ // Next
        if(s==1)sw.checked=true; else{sw.checked=false; let n=new Date(Y,+m.value-1,+d.value+1); m.value=n.getMonth()+1; d.value=n.getDate();}
        if(p=='sol')$(p+'OF').value=+$(p+'OF').value+1;
    } else { // Prev
        if(s==2)sw.checked=false; else{if(s==3)sw.checked=true; else sw.checked=false; let n=new Date(Y,+m.value-1,+d.value-1); m.value=n.getMonth()+1; d.value=n.getDate();}
        if(p=='sol')$(p+'OF').value=+$(p+'OF').value-1;
    }
    window[p+'Run']();
}

/* 1. ë¹„ìƒëŒ€ê¸°ì Parser */
const W_List="ëŒ€ìœ„,ëŒ€ìœ„(ì§„),ì¤‘ìœ„,ì¤‘ìœ„(ì§„),ì†Œìœ„,ì†Œìœ„(ì§„),ì¤€ìœ„,ì›ì‚¬,ì›ì‚¬(ì§„),ìƒì‚¬,ìƒì‚¬(ì§„),ì¤‘ì‚¬,ì¤‘ì‚¬(ì§„),í•˜ì‚¬,í•˜ì‚¬(ì§„)".split(',');
function parseRun(){
    let v=$('parseI').value.replace(/"/g,""); if(!v)return;
    let L1=[], L2=[], A=[];
    v.split('\n').map(L=>{
        let P=L.split('\t'), p1=[], p2=[];
        const f=s=>s.split('/').map(x=>x.trim()).filter(x=>x);
        if(P[0]){ p1=f(P[0]); L1.push(p1.join(', ')); p1.map(x=>A.push({n:x,t:"1ì‹œê°„"})); }
        if(P[1]){ p2=f(P[1]); L2.push(p2.join(', ')); p2.map(x=>A.push({n:x,t:"30ë¶„"})); }
    });
    $('parseO1').innerHTML=`<table border='1'><tr><td>${L1.join('<br>')}</td>${L2.length?`<td>${L2.join('<br>')}</td>`:''}</tr></table>`;
    let F=A.sort((a,b)=>W_List.indexOf(a.n.split(' ')[0])-W_List.indexOf(b.n.split(' ')[0]));
    $('parseO2').innerHTML=`<table border='1'>${F.map(x=>`<tr><td>${x.n}</td><td>${x.t}</td></tr>`).join('')}</table>`;
}

/* 2. ë³‘ì‚¬íœ´ê°€ Scraper */
const SOL_LIST=`ë³‘ì¥ ì´ë¦„1\në³‘ì¥ ì´ë¦„2\në³‘ì¥ ì´ë¦„3\në³‘ì¥ ì´ë¦„4\në³‘ì¥ ì´ë¦„5\në³‘ì¥ ì´ë¦„6\nìƒë³‘ ì´ë¦„7\nìƒë³‘ ì´ë¦„8\nìƒë³‘ ì´ë¦„9\nìƒë³‘ ì´ë¦„10\nìƒë³‘ ì´ë¦„11\nì¼ë³‘ ì´ë¦„12\nì¼ë³‘ ì´ë¦„13\nì¼ë³‘ ì´ë¦„14\nì´ë³‘ ì´ë¦„15`.trim().split('\n');
$('solM').value=2; $('solD').value=20;
function solRun(){
    let m=+$('solM').value, d=+$('solD').value, of=+$('solOF').value, v=$('solI').value, ans=[], W=0;
    let ep=new Date(Y,AM-1,AD-1).setHours(0,0,0,0), target=new Date(Y,m-1,d).setHours(0,0,0,0);
    let s=getSic(m,d,$('solSW').checked), sa=Math.floor(Math.round((target-ep)/864e5)/5)*6+s-of;
    $('solINF').innerText=`[${m}.${d}. ${["MOR","MID","SWI","AFT","BRK","BRK"][s]}]`;
    if(!v)return;
    let gD=a=>new Date(ep+(Math.floor(a/6)*5+[0,1,1,2,3,4][((a%6)+6)%6])*864e5), ls=v.split('\n').map(x=>x.split('\t').map(y=>y.trim()));
    SOL_LIST.forEach((sl,i)=>{
        let r=ls[i]; if(!r)return;
        for(let j=0;j<r.length;j++) if((r[j]=="íœ´"||VM[r[j]]) && gD(sa+j).getTime()==target){
            let st=j, ed=j, lv=r[j]; while(st>0&&r[st-1]==lv)st--; while(ed<r.length-1&&r[ed+1]==lv)ed++;
            if(st==0||ed==r.length-1)W=1;
            ans.push(`${sl}<br><br>${lv=="íœ´"?"":`(${VM[lv]||lv})<br><br>`}${fmtDt(m,gD(sa+st).getDate(),gD(sa+ed).getDate())}`); break;
        }
    });
    $('solO').innerHTML=`<table id='solT' border='1'><tr><td>${ans.join("<br><br>")}</td></tr></table>`;
    $('solMSG').innerText=W?"âš ï¸ ì§¤ë¦¼!":""; qCopy('solO');
}

/* 3. ê°„ë¶€íœ´ê°€ Scraper */
$('offM').value=2; $('offD').value=20;
function offRun(){
    let m=+$('offM').value, d=+$('offD').value, v=$('offI').value, t=0, b=0;
    let R={1:{ì‚¬:[],ì¤€:[],ë¶€:[]},2:{ì‚¬:[],ì¤€:[],ë¶€:[]},3:{ì‚¬:[],ì¤€:[],ë¶€:[]},4:{ì‚¬:[],ì¤€:[],ë¶€:[]}};
    let s=getSic(m,d,$('offSW').checked); $('offINF').innerText=`[${m}.${d}. ${["MOR","MID","SWI","AFT","BRK","BRK"][s]}]`;
    if(!v)return;
    let ls=v.split('\n').map(x=>x.split('\t').map(y=>y.trim())), tCol=-1, lastH=null;
    ls.forEach(L=>{
        if(L.some(c=>c==d.toString())){
            let idxs=L.map((c,i)=>c==d.toString()?i:-1).filter(i=>i!=-1);
            tCol=(idxs.length>1&&$('offSW').checked)?idxs[1]:idxs[0]; lastH=L; if(!b){t++;b=1;} return;
        }
        if(L.length<2||(!L[0]&&!L[1])){b=0; return;}
        let r=L[0], n=L[1], k=r.includes("ì¤€ìœ„")?"ì¤€":r.includes("ìœ„")||r.includes("ë ¹")?"ì‚¬":r.includes("ì‚¬")||r.includes("ì›")?"ë¶€":"";
        if(!k||tCol==-1||!lastH)return;
        let lv=L[tCol]; if(lv=="íœ´"||VM[lv]){
            let st=tCol, ed=tCol; while(st>2&&L[st-1]==lv)st--; while(ed<L.length-1&&L[ed+1]==lv)ed++;
            R[t][k].push(`${r} ${n}<br><br>${lv=="íœ´"?"":`(${VM[lv]||lv})<br><br>`}${fmtDt(m,lastH[st]||d,lastH[ed]||d)}`);
        }
    });
    let h="<table id='offT' border='1'><tr>";
    for(let i=1;i<5;i++) ["ì‚¬","ì¤€","ë¶€"].forEach(k=>h+=`<td valign='top'>${R[i][k].join("<br><br>")}</td>`);
    $('offO').innerHTML=h+"</tr></table>"; qCopy('offO');
}
</script>
</body>
</html>