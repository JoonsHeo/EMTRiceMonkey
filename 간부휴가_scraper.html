<input id="M" size="2">월 <input id="D" size="2">일
<button onclick="X()">조회+복사</button><br>
<textarea id="I" cols="80" rows="10"></textarea>
<div id="O"></div>
<script>
M.value=new Date().getMonth()+1; D.value=new Date().getDate();
function X(){
    let m=M.value, d=+D.value, t=0, b=0, v=["휴","포휴","연가","공가","위로"];
    let R={1:{},2:{},3:{},4:{}};
    for(let i=1;i<5;i++) R[i]={"사":[],"준":[],"부":[]};
    
    I.value.split('\n').forEach(L=>{
        let c=L.split('\t').map(x=>x.trim());
        if(c.length<2) return;
        let r=c[0], n=c[1], k="";
        
        if(r.includes("준위")) k="준";
        else if(r.includes("위")) k="사";
        else if(r.includes("사")) k="부";
        
        if(!k){ b=0; return; }
        if(!b){ t++; b=1; }
        if(t>4) return;
        
        let lv=c[d+1];
        if(v.includes(lv)){
            let S=d, E=d;
            for(let x=d-1; x>0 && c[x+1]==lv; x--) S=x;
            for(let x=d+1; x<32 && c[x+1]==lv; x++) E=x;
            let dt = S==E ? `(${m}.${S}.)` : `(${m}.${S}.~${E}.)`;
            R[t][k].push(`${r} ${n}<br><br>`+(lv=="휴"?"":`(${lv})<br><br>`)+dt);
        }
    });
    
    let h="<table id='T' border='1'><tr>";
    for(let i=1;i<5;i++) ["사","준","부"].forEach(k=>{
        h+=`<td valign='top'>${R[i][k].join("<br><br><br>")}</td>`;
    });
    O.innerHTML = h+"</tr></table>";
    
    let s=getSelection(), rg=document.createRange();
    rg.selectNodeContents(T);
    s.removeAllRanges(); s.addRange(rg);
    document.execCommand("copy");
    alert("복사완료! 엑셀 1열에 붙여넣으세요.");
}
</script>