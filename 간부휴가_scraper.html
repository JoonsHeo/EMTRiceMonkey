<h2 style="margin:5px 0;">ê°„ë¶€íœ´ê°€ Scraper</h2>
ì¡°íšŒì¼: <input id="M" size="2">ì›” <input id="D" size="2">ì¼ 
<label><input type="checkbox" id="SW"> ì¡°íšŒì¼ì´ ìŠ¤ìœ™â˜‘ï¸</label>
<button onclick="P()">âª ì´ì „</button>
<button onclick="X()">ì¡°íšŒ+ë³µì‚¬ ğŸš€</button> 
<button onclick="N()">ë‹¤ìŒ â©</button><br>
<span id="INF" style="color:#27ae60;font-weight:bold;"></span>
<span id="MSG" style="color:red;font-weight:bold;margin-left:5px;"></span><br>
<textarea id="I" cols="80" rows="10" placeholder="ë‚ ì§œ í—¤ë”ë¥¼ í¬í•¨í•˜ì—¬ íŒ€ë³„ ë°ì´í„°ë¥¼ í†µì§¸ë¡œ ë³µë¶™í•˜ì„¸ìš”"></textarea>
<div id="O" style="margin-top:5px; background:#eee; padding:5px;"></div>

<script>
let AM = 2, AD = 17; // ê¸°ì¤€ ë¯¸ë“œì¼
let VM = { "í¬ìƒ":"í¬ìƒíœ´ê°€", "ë³´ìƒ":"ë³´ìƒíœ´ê°€", "ìœ„ë¡œ":"ìœ„ë¡œíœ´ê°€", "í¬íœ´":"í¬ìƒíœ´ê°€", "ì—°ê°€":"ì—°ê°€", "ê³µê°€":"ê³µê°€", "ì™¸ë°•":"ì™¸ë°•" };
let Y = new Date().getFullYear(); M.value = new Date().getMonth()+1; D.value = new Date().getDate();

// ê·¼ë¬´ ì£¼ê¸° ê³„ì‚° (sic: 0:MOR, 1:MID, 2:SWI, 3:AFT, 4:BRK, 5:BRK)
function G(m, d, sw) {
    let ep=new Date(Y,AM-1,AD-1).setHours(0,0,0,0), td=Math.round((new Date(Y,m-1,d).setHours(0,0,0,0)-ep)/864e5);
    let cd=((td%5)+5)%5; return cd==0?0:cd==1?(sw?2:1):cd+1;
}
function N(){ let sic=G(+M.value,+D.value,SW.checked); if(sic==1)SW.checked=true; else {SW.checked=false; let n=new Date(Y,+M.value-1,+D.value+1); M.value=n.getMonth()+1; D.value=n.getDate();} X(); }
function P(){ let sic=G(+M.value,+D.value,SW.checked); if(sic==2)SW.checked=false; else {if(sic==3)SW.checked=true; else SW.checked=false; let n=new Date(Y,+M.value-1,+D.value-1); M.value=n.getMonth()+1; D.value=n.getDate();} X(); }

function X(){
    let m=+M.value, d=+D.value, v=I.value, ans=[], t=0, b=0;
    let R={1:{},2:{},3:{},4:{}}; for(let i=1;i<5;i++) R[i]={"ì‚¬":[],"ì¤€":[],"ë¶€":[]};
    let sic = G(m, d, SW.checked);
    INF.innerText = `[${m}.${d}. ${["MOR","MID","SWI","AFT","BRK","BRK"][sic]} ê¸°ì¤€]`;
    MSG.innerText = ""; if(!v) return;

    let ls = v.split('\n').map(x=>x.split('\t').map(y=>y.trim()));
    let targetCol = -1;

    ls.forEach(L => {
        // 1. í—¤ë” í–‰ ì¸ì‹ (ë‚ ì§œ ìˆ«ìê°€ ìˆëŠ”ì§€ í™•ì¸)
        let isHeader = L.some(c => c == d.toString());
        if(isHeader) {
            // í•´ë‹¹ ë‚ ì§œ(d)ê°€ ì íŒ ì—´ ì¸ë±ìŠ¤ë“¤ ì°¾ê¸°
            let idxs = L.map((c,i) => c==d.toString() ? i : -1).filter(i => i != -1);
            if(idxs.length > 1) targetCol = SW.checked ? idxs[1] : idxs[0]; // MID/SWI êµ¬ë¶„
            else targetCol = idxs[0];
            
            if(!b) { t++; b=1; } // ìƒˆë¡œìš´ íŒ€ ì‹œì‘ ì¸ì‹
            return;
        }

        // 2. ì¸ì› ë°ì´í„° ì²˜ë¦¬
        if(L.length < 2 || (!L[0] && !L[1])) { b=0; return; } // ë¹ˆ ì¤„ì´ë©´ íŒ€ êµ¬ë¶„ ì¤€ë¹„
        let r=L[0], n=L[1], k="";
        if(r.includes("ì¤€ìœ„")) k="ì¤€"; else if(r.includes("ìœ„")||r.includes("ë ¹")) k="ì‚¬"; else if(r.includes("ì‚¬")||r.includes("ì›")) k="ë¶€";
        if(!k || targetCol == -1) return;

        let lv = L[targetCol];
        if(lv=="íœ´" || VM[lv]){
            // ê¸°ê°„ ê³„ì‚°ì„ ìœ„í•œ ë‚ ì§œ ì¶”ì  (ë‹¨ìˆœí™”: ì—‘ì…€ ì¢Œìš° ì¹¸ì´ ê°™ì€ íœ´ê°€ì¸ì§€ ì²´í¬)
            let st=targetCol, ed=targetCol;
            while(st>2 && L[st-1]==lv) st--; while(ed<L.length-1 && L[ed+1]==lv) ed++;
            
            // ë‚ ì§œ í…ìŠ¤íŠ¸ ìƒì„± (í—¤ë” í–‰ì—ì„œ ë‚ ì§œ ìˆ«ìë¥¼ ê°€ì ¸ì˜´)
            // ì‹¤ì œ ë‹¬ë ¥ í—¤ë”ê°€ ìˆëŠ” í–‰ì„ ë‹¤ì‹œ ì°¾ì•„ ë‚ ì§œ ê³„ì‚° (í˜„ì¬ í–‰ ê¸°ì¤€ ê°€ì¥ ê°€ê¹Œìš´ ìœ„ìª½ í—¤ë” ì‚¬ìš©)
            let hL = ls.slice(0, ls.indexOf(L)).reverse().find(row => row.some(c => c != "" && !isNaN(c)));
            let d1 = hL ? hL[st] : d, d2 = hL ? hL[ed] : d;
            let vn = VM[lv] || lv;
            let dt = d1 == d2 ? `(${m}.${d1}.)` : `(${m}.${d1}.~${d2}.)`;
            R[t][k].push(`${r} ${n}<br><br>${lv=="íœ´"?"":`(${vn})<br><br>`}${dt}`);
        }
    });

    let h="<table id='T' border='1'><tr>";
    for(let i=1;i<5;i++) ["ì‚¬","ì¤€","ë¶€"].forEach(k=> h+=`<td valign='top'>${R[i][k].join("<br><br><br>")}</td>`);
    O.innerHTML = h+"</tr></table>";
    
    let s=getSelection(), rg=document.createRange(); rg.selectNodeContents(T); s.removeAllRanges(); s.addRange(rg); document.execCommand("copy"); s.removeAllRanges();
}
</script>