<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í†µì œëŒ€ ì¼ì¼ íœ´ê°€ì ì¶”ì¶œ íˆ´ (ì—°ì†íœ´ê°€ ë³‘í•©)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background-color: #f4f7f6; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 800px; margin: auto; }
        .flex-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 15px; }
        h2 { color: #2c3e50; margin: 0; }
        .date-picker { font-size: 16px; padding: 8px; border: 2px solid #3498db; border-radius: 4px; font-weight: bold; color: #d35400; width: 50px; text-align: center; }
        textarea { width: 100%; height: 150px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; resize: vertical; box-sizing: border-box; font-family: 'Malgun Gothic'; white-space: pre; }
        .main-btn { background-color: #27ae60; color: white; border: none; padding: 12px; font-size: 16px; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%; margin: 15px 0; }
        .main-btn:hover { background-color: #2ecc71; }
        .result-container { width: 100%; padding: 10px; border: 1px solid #3498db; background-color: #f4faff; box-sizing: border-box; overflow-x: auto; min-height: 100px; display: flex; align-items: center; justify-content: center; color: #7f8c8d; }
        table { border-collapse: collapse; width: 100%; background: white; }
        td { border: 1px solid #bdc3c7; padding: 10px; vertical-align: top; font-size: 13px; min-width: 90px; text-align: center; line-height: 1.2; }
    </style>
</head>
<body>

<div class="container">
    <div class="flex-header">
        <h2>ğŸŒ´ í†µì œëŒ€ ì¼ì¼ íœ´ê°€ì ì¶”ì¶œê¸° (ì—°ì†íœ´ê°€ ë³‘í•©)</h2>
        <div>
            <label><b>ì¡°íšŒ ë‚ ì§œ: </b></label>
            <input type="number" id="targetMonth" class="date-picker" min="1" max="12"> ì›”
            <input type="number" id="targetDay" class="date-picker" min="1" max="31"> ì¼
        </div>
    </div>
    
    <label><b>ğŸ“¥ ì—‘ì…€ ë°ì´í„° ì›ë³¸ (íŒ€ êµ¬ë¶„ ì—†ì´ ì‹¹ ë‹¤ ë“œë˜ê·¸í•´ì„œ ë¶™ì—¬ë„£ê¸°):</b></label>
    <textarea id="inputData" placeholder="1ì—´ ì§ê¸‰, 2ì—´ ì´ë¦„, 3ì—´ë¶€í„° ë‚ ì§œê°€ ì‹œì‘ë˜ëŠ” ë‹¬ë ¥ ë°ì´í„°ë¥¼ ë³µë¶™í•˜ì„¸ìš”."></textarea>

    <button class="main-btn" onclick="processLeave()">ê°€ë¡œ 12ì¹¸ (ë³´ê³ ì„œ í¬ë§·) ì¶”ì¶œ ğŸš€</button>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
        <label><b>ğŸ“‹ ì¶œë ¥ ê²°ê³¼:</b></label>
        <button onclick="copyResult()" style="padding: 5px 15px; cursor: pointer; background: #3498db; color: white; border: none; border-radius: 3px; font-weight: bold;">ğŸ“‹ í‘œ í†µì§¸ë¡œ ë³µì‚¬í•˜ê¸°</button>
    </div>
    
    <div id="outputContainer" class="result-container">
        ê²°ê³¼ê°€ ì—¬ê¸°ì— ì‹¤ì œ í‘œ(Table) í˜•íƒœë¡œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
    </div>
</div>

<script>
    const today = new Date();
    document.getElementById("targetMonth").value = today.getMonth() + 1;
    document.getElementById("targetDay").value = today.getDate();

    const validLeaveTypes = ["íœ´", "í¬íœ´", "ì—°ê°€", "ê³µê°€", "ìœ„ë¡œ"];
    
    const rankTypeMap = {
        "ëŒ€ìœ„": "ì‚¬ê´€", "ì¤‘ìœ„": "ì‚¬ê´€", "ì†Œìœ„": "ì‚¬ê´€",
        "ëŒ€ìœ„(ì§„)": "ì‚¬ê´€", "ì¤‘ìœ„(ì§„)": "ì‚¬ê´€", "ì†Œìœ„(ì§„)": "ì‚¬ê´€",
        "ì¤€ìœ„": "ì¤€ì‚¬ê´€",
        "ì›ì‚¬": "ë¶€ì‚¬ê´€", "ì›ì‚¬(ì§„)": "ë¶€ì‚¬ê´€", 
        "ìƒì‚¬": "ë¶€ì‚¬ê´€", "ìƒì‚¬(ì§„)": "ë¶€ì‚¬ê´€", 
        "ì¤‘ì‚¬": "ë¶€ì‚¬ê´€", "ì¤‘ì‚¬(ì§„)": "ë¶€ì‚¬ê´€", 
        "í•˜ì‚¬": "ë¶€ì‚¬ê´€", "í•˜ì‚¬(ì§„)": "ë¶€ì‚¬ê´€"
    };

    function processLeave() {
        const rawText = document.getElementById("inputData").value;
        const targetMonth = document.getElementById("targetMonth").value;
        const targetDay = parseInt(document.getElementById("targetDay").value, 10);
        
        if (!rawText.trim()) { alert("ì—‘ì…€ ë°ì´í„°ë¥¼ ë¨¼ì € ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”."); return; }

        const results = {
            1: { "ì‚¬ê´€": [], "ì¤€ì‚¬ê´€": [], "ë¶€ì‚¬ê´€": [] },
            2: { "ì‚¬ê´€": [], "ì¤€ì‚¬ê´€": [], "ë¶€ì‚¬ê´€": [] },
            3: { "ì‚¬ê´€": [], "ì¤€ì‚¬ê´€": [], "ë¶€ì‚¬ê´€": [] },
            4: { "ì‚¬ê´€": [], "ì¤€ì‚¬ê´€": [], "ë¶€ì‚¬ê´€": [] }
        };

        const lines = rawText.split("\n");
        let currentTeam = 0;
        let isPersonBlock = false;

        for (let line of lines) {
            let cells = line.split("\t").map(s => s.trim());
            if (cells.length < 2) continue;

            let rank = cells[0];
            let name = cells[1];
            let type = rankTypeMap[rank];

            if (!type) { isPersonBlock = false; continue; }
            if (!isPersonBlock) { currentTeam++; isPersonBlock = true; }
            if (currentTeam > 4) break;

            let dayIndex = targetDay + 1;

            if (cells.length > dayIndex) {
                let leaveVal = cells[dayIndex];
                
                // ì˜¤ëŠ˜ ë‚ ì§œì— ì§€ì •ëœ íœ´ê°€(íœ´, í¬íœ´ ë“±)ê°€ ìˆë‹¤ë©´
                if (validLeaveTypes.includes(leaveVal)) {
                    
                    // â­ï¸ ì—°ì† íœ´ê°€ ì¶”ì  ë¡œì§ ì‹œì‘ â­ï¸
                    let startDay = targetDay;
                    let endDay = targetDay;

                    // 1. ê³¼ê±°ë¡œ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ë©° ê°™ì€ íœ´ê°€ì¸ì§€ í™•ì¸
                    for (let d = targetDay - 1; d >= 1; d--) {
                        let idx = d + 1;
                        if (cells.length > idx && cells[idx] === leaveVal) {
                            startDay = d; // ê°™ì€ íœ´ê°€ë©´ ì‹œì‘ì¼ì„ ì•ë‹¹ê¹€
                        } else {
                            break; // ë‹¤ë¥¸ ê¸€ìë‚˜ ë¹ˆì¹¸ì´ ë‚˜ì˜¤ë©´ ì¶”ì  ì¤‘ì§€
                        }
                    }

                    // 2. ë¯¸ë˜ë¡œ ì „ì§„í•˜ë©° ê°™ì€ íœ´ê°€ì¸ì§€ í™•ì¸
                    for (let d = targetDay + 1; d <= 31; d++) {
                        let idx = d + 1;
                        if (cells.length > idx && cells[idx] === leaveVal) {
                            endDay = d; // ê°™ì€ íœ´ê°€ë©´ ì¢…ë£Œì¼ì„ ëŠ¦ì¶¤
                        } else {
                            break; // ë‹¤ë¥¸ ê¸€ìë‚˜ ë¹ˆì¹¸ì´ ë‚˜ì˜¤ë©´ ì¶”ì  ì¤‘ì§€
                        }
                    }

                    // â­ï¸ ì¶œë ¥ í¬ë§· ì¡°ë¦½ â­ï¸
                    let infoBlocks = [];
                    infoBlocks.push(`${rank} ${name}`); // ì§ê¸‰ ì´ë¦„
                    
                    if (leaveVal !== "íœ´") {
                        infoBlocks.push(`(${leaveVal})`); // 'íœ´'ê°€ ì•„ë‹ ë•Œë§Œ ì¢…ë¥˜ í‘œì‹œ
                    }
                    
                    // ë‚ ì§œ í‘œì‹œ (ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì´ ê°™ìœ¼ë©´ í•˜ë£¨, ë‹¤ë¥´ë©´ ë¬¼ê²°í‘œì‹œ ë³‘í•©)
                    if (startDay === endDay) {
                        infoBlocks.push(`(${targetMonth}.${startDay}.)`);
                    } else {
                        infoBlocks.push(`(${targetMonth}.${startDay}.~${endDay}.)`);
                    }
                    
                    let personString = infoBlocks.join("<br><br>");
                    results[currentTeam][type].push(personString);
                }
            }
        }

        let tableHTML = "<table id='outputTable'><tr>";
        for (let t = 1; t <= 4; t++) {
            ["ì‚¬ê´€", "ì¤€ì‚¬ê´€", "ë¶€ì‚¬ê´€"].forEach(type => {
                let cellText = results[t][type].join("<br><br><br>");
                tableHTML += `<td>${cellText}</td>`;
            });
        }
        tableHTML += "</tr></table>";
        
        document.getElementById("outputContainer").innerHTML = tableHTML;
    }

    function copyResult() {
        const table = document.getElementById("outputTable");
        if (!table) return;

        const selection = window.getSelection();
        const range = document.createRange();
        range.selectNodeContents(table);
        
        selection.removeAllRanges();
        selection.addRange(range);
        document.execCommand("copy");
        selection.removeAllRanges(); 
        
        alert("í‘œ ë³µì‚¬ ì™„ë£Œ!\nì—‘ì…€ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.");
    }
</script>

</body>
</html>